-- ユーザーテーブル
CREATE TABLE users (
 user_id BIGSERIAL PRIMARY KEY, -- ユーザーID（主キー）
 username VARCHAR(50) NOT NULL, -- 表示用ユーザー名
 email VARCHAR(255) NOT NULL UNIQUE, -- ログイン用メール
 password_hash VARCHAR(255) NOT NULL, -- パスワード（ハッシュ化済）
 phone_number VARCHAR(20), -- 電話番号
 gender CHAR(1) CHECK (gender IN ('M','F','O')), -- 性別 (M=男性, F=女性, O=その他)
 birth_date DATE, -- 生年月日
 profile_image_url TEXT, -- プロフィール画像URL
 address_line1 VARCHAR(255), -- 住所1
 address_line2 VARCHAR(255), -- 住所2
 city VARCHAR(100), -- 市区町村
 state VARCHAR(100), -- 都道府県
 postal_code VARCHAR(20), -- 郵便番号
 country VARCHAR(50), -- 国
 is_active BOOLEAN DEFAULT TRUE, -- アクティブ状態
 email_verified BOOLEAN DEFAULT FALSE, -- メール認証済みか
 created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- 作成日時
 updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP -- 更新日時
);
 
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
 NEW.updated_at = NOW();
 RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_users_updated_at
BEFORE UPDATE ON users
FOR EACH ROW
EXECUTE PROCEDURE update_updated_at_column();


COMMENT ON TABLE users IS 'ユーザーテーブル';

COMMENT ON COLUMN users.user_id IS 'ユーザーID（主キー）';
COMMENT ON COLUMN users.username IS '表示用ユーザー名';
COMMENT ON COLUMN users.email IS 'ログイン用メール';
COMMENT ON COLUMN users.password_hash IS 'パスワード（ハッシュ化済）';
COMMENT ON COLUMN users.phone_number IS '電話番号';
COMMENT ON COLUMN users.gender IS '性別 (M=男性, F=女性, O=その他)';
COMMENT ON COLUMN users.birth_date IS '生年月日';
COMMENT ON COLUMN users.profile_image_url IS 'プロフィール画像URL';
COMMENT ON COLUMN users.address_line1 IS '住所1';
COMMENT ON COLUMN users.address_line2 IS '住所2';
COMMENT ON COLUMN users.city IS '市区町村';
COMMENT ON COLUMN users.state IS '都道府県';
COMMENT ON COLUMN users.postal_code IS '郵便番号';
COMMENT ON COLUMN users.country IS '国';
COMMENT ON COLUMN users.is_active IS 'アクティブ状態';
COMMENT ON COLUMN users.email_verified IS 'メール認証済みか';
COMMENT ON COLUMN users.created_at IS '作成日時';
COMMENT ON COLUMN users.updated_at IS '更新日時';